# 2026-01-02 수정 내역

## 파일: `app/routers/auth_router.py`

### 변경 사항

- **버그 수정**: `IndentationError` 해결

### 상세 설명

- 기존 코드의 주석 처리된 `@router.get("/auth/callback")` 데코레이터 아래 `google_callback` 함수 정의 부분에서, 함수 파라미터들이 주석 처리되지 않아 들여쓰기 오류가 발생했습니다.
- 오류를 해결하기 위해 해당 파라미터 라인들을 주석 처리하여 올바른 파이썬 문법이 되도록 수정했습니다.
# 2026-01-02 수정 내역

## 파일: `app/routers/auth_router.py`

### 변경 사항

- **버그 수정**: `IndentationError: expected an indented block` 해결

### 상세 설명

- `google_callback` 함수가 중복으로 정의되어 있었고, 두 번째 함수 정의에는 본문이 없어 들여쓰기 오류가 발생했습니다.
- 오류를 해결하기 위해 중복으로 정의된, 본문이 없는 `google_callback` 함수를 삭제했습니다.
# 2026-01-02 수정 내역

## 파일: `app/config/settings.py`

### 변경 사항

- **버그 수정**: 데이터베이스 연결을 위한 환경 변수명 불일치 해결

### 상세 설명

- FastAPI 애플리케이션(`settings.py`)과 데이터베이스 연결 테스트 스크립트(`test_db_connection.py`)가 사용하는 데이터베이스 호스트 및 포트의 환경 변수명이 달라 서버 시작 오류가 발생하는 문제를 확인했습니다.
- `settings.py`에서 사용하던 `POSTGRES_SERVER`와 `POSTGRES_PORT`를 테스트 스크립트에서 사용하고 있던 `db_host`와 `db_port`로 각각 변경하여 환경 변수명을 일치시켰습니다.
- 이 변경을 통해 애플리케이션이 `.env` 파일의 올바른 데이터베이스 설정 값을 읽어올 수 있도록 수정했습니다.
# 2026-01-02 수정 내역

## 파일: `requirements.txt`

### 변경 사항

- **버그 수정**: `email-validator` `ImportError` 해결 및 `requirements.txt` 형식 오류 수정

### 상세 설명

- `email-validator`가 설치되지 않아 발생하는 `ImportError`를 해결하기 위해 `requirements.txt`에 `pydantic[email]` 의존성을 추가했습니다.
- 이 과정에서 `pydantic[email]pydantic-settings`와 같이 두 항목이 한 줄에 잘못 병합되는 형식 오류가 발생하여, 이를 `pydantic[email]`과 `pydantic-settings`로 두 개의 별도 줄로 분리하여 수정했습니다.
- 모든 의존성을 다시 설치하여 변경 사항을 적용했습니다.
# 2026-01-02 수정 내역

## 파일: `venv` 환경

### 변경 사항

- **버그 수정**: `email-validator` `ModuleNotFoundError` 해결

### 상세 설명

- `email-validator` 모듈이 가상 환경에서 올바르게 설치되지 않아 발생하는 `ModuleNotFoundError`를 확인했습니다.
- `/apps/dodt_api/venv/bin/pip install email-validator` 명령을 사용하여 가상 환경에 `email-validator`를 명시적으로 설치했습니다. 이로써 `email-validator`와 관련 의존성(`dnspython`)이 성공적으로 설치되었습니다.
# 2026-01-02 수정 내역

## 데이터베이스 스키마 적용

### 변경 사항

- **버그 수정**: `asyncpg.exceptions.UndefinedTableError: relation "media_likes" does not exist` 해결

### 상세 설명

- `media_likes` 테이블이 데이터베이스에 존재하지 않아 발생하는 `UndefinedTableError`를 확인했습니다.
- `db/schema.sql` 파일에 테이블 정의가 이미 포함되어 있었으나, 실제 데이터베이스에는 적용되지 않은 상태였습니다.
- `PGPASSWORD` 환경 변수를 사용하여 데이터베이스 암호를 전달하고, `psql` 명령을 실행하여 `db/schema.sql`의 스키마를 데이터베이스에 성공적으로 적용했습니다. 이로써 `media_likes` 테이블이 생성되었습니다.
# 2026-01-02 수정 내역

## 파일: `app/routers/auth_router.py`

### 변경 사항

- **버그 수정**: `422 (Unprocessable Entity)` 오류 해결

### 상세 설명

- Google OAuth 콜백 처리 중 `code`와 `state` 파라미터가 누락될 경우 발생하는 `422 Unprocessable Entity` 오류를 해결했습니다.
- 이 문제는 주로 사용자가 Google 로그인 화면에서 접근을 거부할 때 발생합니다.
- `google_callback` 함수를 수정하여 `code`와 `state`를 선택적 파라미터로 변경하고, `error` 파라미터를 추가로 받도록 했습니다.
- `error`가 있거나 `code` 또는 `state`가 없는 경우, 오류 메시지와 함께 로그인 페이지로 리디렉션하는 예외 처리 로직을 추가했습니다.
# 2026-01-02 수정 내역

## 파일: `.env` 및 `app/routers/auth_router.py`

### 변경 사항

- **버그 수정**: `400 오류: redirect_uri_mismatch` (경로 불일치) 해결

### 상세 설명

- Google Cloud Console에 등록된 리디렉션 URI 경로(`http://localhost:8000/rest/oauth2-credential/callback`)와 애플리케이션에서 사용하는 URI 경로(`http://localhost:8000/auth/callback`)가 서로 달라 발생하는 `redirect_uri_mismatch` 오류를 확인했습니다.
- `.env` 파일의 `GOOGLE_REDIRECT_URI` 값을 Google Cloud Console에 등록된 경로와 일치하도록 `http://localhost:8000/rest/oauth2-credential/callback`로 수정했습니다.
- `app/routers/auth_router.py` 파일 내 `google_callback` 함수의 `@router.get` 데코레이터 경로도 `/auth/callback`에서 `/rest/oauth2-credential/callback`으로 변경하여 애플리케이션의 라우트 정의를 일치시켰습니다.
